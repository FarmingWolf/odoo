<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <record id="estate_lease_contract_view_form_action" model="ir.actions.act_window">
        <field name="name">新建合同</field>
        <field name="res_model">estate.lease.contract</field>
        <field name="view_mode">form</field>
        <field name="context">{}</field>
        <field name="target">new</field>
        <field name="view_id" ref="estate_lease_contract_view_form"/>
    </record>

    <record id="estate_lease_contract_view_form" model="ir.ui.view">
        <field name="name">estate.lease.contract.form</field>
        <field name="model">estate.lease.contract</field>
        <field name="arch" type="xml">
            <form string="estate_lease_contract_form" duplicate="False">
                <header>
                    <field name="company_id" invisible="1"/>
                    <field name="edit_on_hist_page" invisible="1"/>
                    <field name="contract_hist" invisible="1"/>
                    <button name="action_release_contract" type="object" string="发布"
                            invisible="(not edit_on_hist_page) or (state != 'recording')"/>
                    <button name="action_cancel_release_contract" type="object" string="取消发布"
                            invisible="(not edit_on_hist_page) or (state not in ['released', 'to_be_released'])"/>
                    <button name="action_contract_renewal" type="object" string="续租"
                            groups="estate_lease_contract.estate_lease_contract_group_manager"
                            invisible="state not in ['released', 'invalid']"/>
                    <field name="state" widget="statusbar"/>
                </header>
                <sheet>
                    <group col="2">
                        <group>
                            <field name="default_context_contract_id" invisible="1"/>
                            <field name="name" readonly="context.get('contract_read_only')"/>
                            <field name="contract_no" readonly="not edit_on_hist_page"/>
                            <field name="contract_type_id" readonly="not edit_on_hist_page"/>
                            <field name="renter_id" readonly="not edit_on_hist_page"/>
                            <field name="renter_company_id" readonly="not edit_on_hist_page"/>
                            <field name="sales_person_id" readonly="not edit_on_hist_page"/>
                            <field name="opt_person_id" readonly="not edit_on_hist_page"/>
                            <field name="date_sign" readonly="not edit_on_hist_page"/>
                            <field name="date_start" readonly="not edit_on_hist_page"/>
                            <field name="lease_deposit"/>
                            <field name="rent_amount"/>
                            <field name="rent_amount_year"/>
                        </group>
                        <group>
                            <field name="sequence" readonly="not edit_on_hist_page"/>
                            <field name="date_rent_start" readonly="not edit_on_hist_page"/>
                            <field name="date_rent_end" readonly="not edit_on_hist_page"/>
                            <field name="days_rent_total" readonly="1"/>
                            <field name="days_free" readonly="not edit_on_hist_page" invisible="1"/>
                            <field name="date_decorate_start" readonly="not edit_on_hist_page"/>
                            <field name="date_decorate_end" readonly="not edit_on_hist_page"/>
                            <field name="days_decorate" readonly="1"/>
                            <field name="opening_date" readonly="not edit_on_hist_page"/>
                            <field name="rent_amount_first_period" readonly="not edit_on_hist_page"/>
                            <field name="rent_first_payment_date" readonly="not edit_on_hist_page"/>
                            <field name="tag_ids" widget="many2many_tags" string="标签" options="{'color_field': 'color'}"
                                   readonly="not edit_on_hist_page"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="租赁标的">
                            <group col="4">
                                <group>
                                    <field name="rent_count"/>
                                </group>
                                <group>
                                    <field name="rent_area" string="面积（㎡）"/>
                                </group>
                                <group>
                                    <field name="rent_amount"/>
                                </group>
                                <group>
                                    <field name="rent_amount_year"/>
                                </group>
                            </group>
                            <field name="property_ids" readonly="not edit_on_hist_page"
                                   invisible="state != 'recording'"/>
                            <field name="contract_hist" readonly="1" invisible="state == 'recording'">
                                <tree string="" decoration-success="contract_property_state=='sold'"
                                      decoration-warning="contract_property_state=='canceled'">
                                    <field name="sequence" widget="handle"/>
                                    <field name="contract_property_name"/>
                                    <field name="contract_renter_id"/>
                                    <field name="contract_property_state"/>
                                    <field name="contract_property_area"/>
                                    <field name="contract_property_rent_price"/>
                                    <field name="contract_rent_amount_monthly"/>
                                    <field name="contract_rent_amount_year"/>
                                    <field name="contract_rent_payment_method"/>
                                </tree>
                            </field>
                        </page>
                        <page string="停车位">
                            <group>
                                <field name="parking_space_count"/>
                            </group>
                            <field name="parking_space_ids"/>
                        </page>
                        <page string="租金方案">
                            <button name="action_refresh_rental_plan" type="object" string="点击刷新"
                                    invisible="context.get('contract_read_only')"/>
                            <field name="rental_plan_ids"/>
                        </page>
                        <page string="物业费方案" id="page_management_fee_plan" invisible="1">
                            <button name="action_refresh_management_fee_plan" type="object" string="点击刷新"
                                    invisible="not edit_on_hist_page"/>
                            <field name="property_management_fee_plan_ids"/>
                        </page>
                        <page string="优惠方案" id="page_incentives" invisible="1">
                            <group>
                                <field name="contract_incentives_ids"/>
                            </group>
                            <sheet>
                                <group>
                                    <group string="合计总优惠">
                                        <group>
                                            <field name="incentives_days_total"/>
                                            <field name="incentives_amount_total"/>
                                        </group>
                                        <group>
                                            <field name="contract_incentives_description"/>
                                        </group>
                                    </group>

                                    <group string="政策有效期">
                                        <field name="date_incentives_start"/>
                                        <field name="date_incentives_end"/>
                                    </group>

                                    <group string="其中">
                                        <field name="days_free"/>
                                    </group>
                                    <group string="经营优惠">
                                        <group>
                                            <field name="business_discount_days"/>
                                        </group>
                                        <group>
                                            <field name="business_discount_amount"/>
                                        </group>
                                    </group>
                                    <group string="装修优惠">
                                        <group>
                                            <field name="decoration_discount_days"/>
                                        </group>
                                        <group>
                                            <field name="decoration_discount_amount"/>
                                        </group>
                                    </group>
                                    <group string="扶持优惠">
                                        <group>
                                            <field name="support_discount_days"/>
                                        </group>
                                        <group>
                                            <field name="support_discount_amount"/>
                                        </group>
                                    </group>
                                    <group string="专项优惠">
                                        <group>
                                            <field name="special_discount_days"/>
                                        </group>
                                        <group>
                                            <field name="special_discount_amount"/>
                                        </group>
                                    </group>
                                </group>
                            </sheet>
                        </page>
                        <page string="收款账户" id="page_bank_account">
                            <group col="2">
                                <group col="1">
                                    <group col="1">
                                        <group string="租金账户" col="1">
                                            <field name="rent_account" placeholder="请选择"/>
                                            <group invisible="rent_account == False">
                                                <field name="rent_account_bank_name" string="银行名称"/>
                                                <field name="rent_account_bank_branch_name" string="分行名称"/>
                                                <field name="rent_account_bank_account_name" string="账户名称"/>
                                                <field name="rent_account_bank_account_id" string="账号"/>
                                            </group>
                                        </group>
                                    </group>
                                    <group col="1">
                                        <group string="物业费账户" col="1">
                                            <field name="property_management_fee_account" placeholder="请选择"/>
                                            <group invisible="property_management_fee_account == False">
                                                <field name="property_management_fee_account_bank_name" string="银行名称"/>
                                                <field name="property_management_fee_account_bank_branch_name"
                                                       string="分行名称"/>
                                                <field name="property_management_fee_account_bank_account_name"
                                                       string="账户名称"/>
                                                <field name="property_management_fee_account_bank_account_id"
                                                       string="账号"/>
                                            </group>
                                        </group>
                                    </group>
                                    <group col="1">
                                        <group string="停车费账户" col="1">
                                            <field name="parking_fee_account" placeholder="请选择"/>
                                            <group invisible="parking_fee_account == False">
                                                <field name="parking_fee_account_bank_name" string="银行名称"/>
                                                <field name="parking_fee_account_bank_branch_name" string="分行名称"/>
                                                <field name="parking_fee_account_bank_account_name" string="账户名称"/>
                                                <field name="parking_fee_account_bank_account_id" string="账号"/>
                                            </group>
                                        </group>
                                    </group>
                                </group>
                                <group col="1">
                                    <group col="1">
                                        <group string="押金账户" col="1">
                                            <field name="pledge_account" placeholder="请选择"/>
                                            <group invisible="pledge_account == False">
                                                <field name="pledge_account_bank_name" string="银行名称"/>
                                                <field name="pledge_account_bank_branch_name" string="分行名称"/>
                                                <field name="pledge_account_bank_account_name" string="账户名称"/>
                                                <field name="pledge_account_bank_account_id" string="账号"/>
                                            </group>
                                        </group>
                                    </group>
                                    <group col="1">
                                        <group string="电费账户" col="1">
                                            <field name="electricity_account" placeholder="请选择"/>
                                            <group invisible="electricity_account == False">
                                                <field name="electricity_account_bank_name" string="银行名称"/>
                                                <field name="electricity_account_bank_branch_name" string="分行名称"/>
                                                <field name="electricity_account_bank_account_name" string="账户名称"/>
                                                <field name="electricity_account_bank_account_id" string="账号"/>
                                            </group>
                                        </group>
                                    </group>
                                    <group col="1">
                                        <group string="水费账户" col="1">
                                            <field name="water_bill_account" placeholder="请选择"/>
                                            <group invisible="water_bill_account == False">
                                                <field name="water_bill_account_bank_name" string="银行名称"/>
                                                <field name="water_bill_account_bank_branch_name" string="分行名称"/>
                                                <field name="water_bill_account_bank_account_name" string="账户名称"/>
                                                <field name="water_bill_account_bank_account_id" string="账号"/>
                                            </group>
                                        </group>
                                    </group>
                                </group>
                            </group>
                        </page>
                        <page string="附件">
                            <group>
                                <field name="attachment_ids" widget="many2many_binary" options="{'no_create': True}"/>
                            </group>
                        </page>
                        <page string="每期金额明细">
                            <group col="6">
                                <group col="1" colspan="1" invisible="context.get('contract_read_only')">
                                    <button name="action_refresh_all_money" type="object" string="点击刷新"/>
                                </group>
                                <group col="1" colspan="5">
                                    <field name="warn_msg" string="" readonly="1"/>
                                </group>
                            </group>
                            <sheet readonly="1">
                                <group>
                                    <group string="todo" invisible="1">
                                        <group string="租金（优惠后）">
                                            <group string="首期租金">
                                            </group>
                                            <group string="押金">
                                            </group>

                                        </group>
                                        <group string="物业费">

                                        </group>
                                    </group>
                                    <field name="rental_details" readonly="not edit_on_hist_page">
                                        <tree string=""
                                              decoration-danger="(rental_amount != rental_receivable) or edited"
                                              decoration-success="rental_received &gt; 0 and rental_received == rental_receivable"
                                              decoration-warning="rental_received != 0 and rental_received != rental_receivable"
                                              readonly="not parent.edit_on_hist_page">
                                            <field name="edited" column_invisible="True"/>
                                            <field name="property_id"/>
                                            <field name="rental_period_no"/>
                                            <field name="period_date_from"/>
                                            <field name="period_date_to"/>
                                            <field name="date_payment"/>
                                            <field name="rental_amount" digits="[12, 2]" sum="合计租金：根据资产面积、租金方案自动计算"/>
                                            <field name="rental_receivable" digits="[12, 2]" sum="合计应收：请谨慎调整，系统自动记录调整历史"/>
                                            <field name="rental_received" digits="[12, 2]" sum="合计实收：每期租金收款后，请回填，以保证业务数据一致性"/>
                                        </tree>
                                    </field>
                                </group>
                            </sheet>
                        </page>
                    </notebook>

                </sheet>
                <div class="oe_chatter" groups="estate.estate_group_tutorial_research">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <record id="estate_lease_contract_view_tree" model="ir.ui.view">
        <field name="name">estate.lease.contract.tree</field>
        <field name="model">estate.lease.contract</field>
        <field name="arch" type="xml">
            <tree string="contracts_tree"
                  decoration-success="date_rent_end &gt; (datetime.datetime.combine(context_today() + relativedelta(days=365), datetime.time(0,0,0)).to_utc()).strftime('%Y-%m-%d')"
                  decoration-info="(date_rent_end &lt; (datetime.datetime.combine(context_today() + relativedelta(days=365), datetime.time(0,0,0)).to_utc()).strftime('%Y-%m-%d')) and (date_rent_end &gt; (datetime.datetime.combine(context_today() + relativedelta(days=30), datetime.time(0,0,0)).to_utc()).strftime('%Y-%m-%d'))"
                  decoration-warning="(date_rent_end &lt; (datetime.datetime.combine(context_today() + relativedelta(days=30), datetime.time(0,0,0)).to_utc()).strftime('%Y-%m-%d')) and (date_rent_end &gt; (datetime.datetime.combine(context_today(), datetime.time(0,0,0)).to_utc()).strftime('%Y-%m-%d'))"
                  decoration-muted="date_rent_end &lt; (datetime.datetime.combine(context_today(), datetime.time(0,0,0)).to_utc()).strftime('%Y-%m-%d')"
                  create="False" delete="False" edit="False" import="False" open_form_view="False">

                <field name="default_context_contract_id" column_invisible="1"/>
                <field name="sequence" widget="handle"/>
                <field name="property_ids" widget="many2many_tags" string="租赁房屋" options="{'color_field': 'color'}"/>
                <field name="contract_no"/>
                <field name="date_sign"/>
                <field name="date_start"/>
                <field name="date_rent_start"/>
                <field name="date_rent_end"/>
                <field name="state"/>
                <field name="parking_space_ids" widget="many2many_tags" string="车位" options="{'color_field': 'color'}"/>
                <field name="renter_id"/>
                <field name="renter_company_id"/>
            </tree>
        </field>
    </record>

    <record id="estate_lease_contract_view_inactive_tree" model="ir.ui.view">
        <field name="name">estate.lease.contract.tree</field>
        <field name="model">estate.lease.contract</field>
        <field name="arch" type="xml">
            <tree string="contracts_tree"
                  decoration-success="date_rent_end &gt; (datetime.datetime.combine(context_today() + relativedelta(days=365), datetime.time(0,0,0)).to_utc()).strftime('%Y-%m-%d')"
                  decoration-info="(date_rent_end &lt; (datetime.datetime.combine(context_today() + relativedelta(days=365), datetime.time(0,0,0)).to_utc()).strftime('%Y-%m-%d')) and (date_rent_end &gt; (datetime.datetime.combine(context_today() + relativedelta(days=30), datetime.time(0,0,0)).to_utc()).strftime('%Y-%m-%d'))"
                  decoration-warning="(date_rent_end &lt; (datetime.datetime.combine(context_today() + relativedelta(days=30), datetime.time(0,0,0)).to_utc()).strftime('%Y-%m-%d')) and (date_rent_end &gt; (datetime.datetime.combine(context_today(), datetime.time(0,0,0)).to_utc()).strftime('%Y-%m-%d'))"
                  decoration-muted="date_rent_end &lt; (datetime.datetime.combine(context_today(), datetime.time(0,0,0)).to_utc()).strftime('%Y-%m-%d')"
                  create="True" delete="True" edit="True">
                <field name="default_context_contract_id" column_invisible="1"/>
                <field name="sequence" widget="handle"/>
                <field name="property_ids" widget="many2many_tags" string="租赁房屋" options="{'color_field': 'color'}"/>
                <field name="contract_no"/>
                <field name="date_sign"/>
                <field name="date_start"/>
                <field name="date_rent_start"/>
                <field name="date_rent_end"/>
                <field name="state"/>
                <field name="parking_space_ids" widget="many2many_tags" string="车位" options="{'color_field': 'color'}"/>
                <field name="renter_id"/>
                <field name="renter_company_id"/>
            </tree>
        </field>
    </record>

    <record id="estate_lease_contract_action" model="ir.actions.act_window">
        <field name="name">资产租赁合同列表（查看）</field>
        <field name="res_model">estate.lease.contract</field>
        <field name="view_mode">tree,form,kanban</field>
        <field name="views">[False, "tree"]</field>
        <field name="view_id" ref="estate_lease_contract_view_tree"/>
        <field name="context">{
            'search_default_active': True,
            'contract_read_only': True,
            'menu_root': 'estate.lease.contract',
            }
        </field>
        <field name="domain">[('active', '=', True)]</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                还没有合同信息。
            </p>
            <p>
                说明合同还没录入，或者录入了也没发布。
            </p>
        </field>
    </record>

    <record id="estate_lease_contract_action_recording" model="ir.actions.act_window">
        <field name="name">资产租赁合同列表（录入）</field>
        <field name="res_model">estate.lease.contract</field>
        <field name="views">[False, "tree"]</field>
        <field name="view_id" ref="estate_lease_contract_view_inactive_tree"/>
        <field name="view_mode">tree,form,kanban</field>
        <field name="context">{
            'search_default_active': False,
            'contract_read_only': False,
            'menu_root': 'estate.lease.contract',}
        </field>
        <field name="domain">[('active', '=', False)]</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                录入中的合同都在这里。
            </p>
        </field>
    </record>

</odoo>
